package test;

import simu.framework.Trace;
import simu.framework.Trace.Level;
import simu.model.*;

/**
 * Ultra-Comprehensive PESTEL Simulation Test
 * Features: 100 companies, 50 countries, 40 research centers, 30-day simulation
 * True AI integration with comprehensive agent-to-agent interactions
 */
public class UltraComprehensivePESTELTest {
    
    public static void main(String[] args) {
        Trace.setTraceLevel(Level.INFO);
        
        System.out.println("=== ULTRA-COMPREHENSIVE AI-ENHANCED PESTEL SIMULATION ===");
        System.out.println("Metropolia University Advanced Strategic Planning System");
        System.out.println("🌍 Global Coverage: 100 Companies + 50 Countries + 40 Research Centers");
        System.out.println("🤖 True AI Integration: Qwen3-Next-80B-A3B-Thinking Model");
        System.out.println("🔮 20 Alternative Future Scenarios with Advanced Analytics");
        System.out.println("⚡ 30-Day Comprehensive Simulation");
        System.out.println();
        
        // Display ultra-comprehensive entities
        displayUltraComprehensiveEntities();
        
        // Run AI-enhanced simulation
        runAIEnhancedSimulation();
        
        System.out.println("\n=== ULTRA-COMPREHENSIVE SIMULATION COMPLETED ===");
    }
    
    private static void displayUltraComprehensiveEntities() {
        System.out.println("🌍 ULTRA-COMPREHENSIVE REAL-WORLD ENTITIES:");
        
        System.out.println("\n🏢 TOP 100 GLOBAL COMPANIES:");
        System.out.println("   🖥️ Technology (20): Apple ($391B), Microsoft ($365B), Alphabet ($350B), Amazon ($638B)");
        System.out.println("      Meta ($134B), Tesla ($127B), NVIDIA ($118B), Samsung ($279B), TSMC ($89B)");
        System.out.println("      Sony ($98B), Intel ($87B), IBM ($72B), Oracle ($65B), Salesforce ($45B)");
        System.out.println("      Adobe ($35B), Netflix ($32B), PayPal ($29B), Uber ($28B), Spotify ($15B), Zoom ($8B)");
        
        System.out.println("   🛒 Retail & E-commerce (15): Walmart ($681B), Costco ($249B), Home Depot ($157B)");
        System.out.println("      Target ($109B), Lowe's ($97B), Alibaba ($145B), JD.com ($149B), Shopify ($8B)");
        System.out.println("      eBay ($10B), Rakuten ($18B), MercadoLibre ($12B), Sea Limited ($16B)");
        
        System.out.println("   ⚡ Energy & Utilities (15): Saudi Aramco ($480B), China National Petroleum ($413B)");
        System.out.println("      Sinopec ($407B), State Grid ($548B), ExxonMobil ($413B), Shell ($381B)");
        System.out.println("      Chevron ($235B), TotalEnergies ($263B), BP ($164B), ConocoPhillips ($75B)");
        
        System.out.println("   🏥 Healthcare & Pharma (15): UnitedHealth ($400B), CVS Health ($373B), J&J ($100B)");
        System.out.println("      Pfizer ($58B), Roche ($71B), Novartis ($51B), Merck ($62B), AbbVie ($67B)");
        System.out.println("      Bristol Myers Squibb ($46B), AstraZeneca ($44B), GSK ($41B), Sanofi ($44B)");
        
        System.out.println("   💰 Financial Services (15): JPMorgan ($158B), Bank of America ($119B)");
        System.out.println("      Wells Fargo ($87B), Goldman Sachs ($59B), Morgan Stanley ($64B), Citigroup ($75B)");
        System.out.println("      American Express ($64B), Visa ($32B), Mastercard ($25B), BlackRock ($21B)");
        
        System.out.println("   🚗 Automotive (10): Volkswagen ($295B), Toyota ($274B), Mercedes ($186B)");
        System.out.println("      BMW ($142B), General Motors ($138B), Ford ($156B), Stellantis ($300B)");
        
        System.out.println("   🍔 Consumer Goods (10): P&G ($84B), Coca-Cola ($46B), PepsiCo ($91B)");
        System.out.println("      Unilever ($61B), Nestlé ($103B), L'Oréal ($39B), Nike ($51B), Adidas ($22B)");
        
        System.out.println("\n🏛️ TOP 50 MOST INFLUENTIAL COUNTRIES:");
        System.out.println("   🌟 Global Superpowers: USA ($26.9T), China ($17.7T), Japan ($4.9T), Germany ($4.3T), India ($3.4T)");
        System.out.println("   🇪🇺 European Powers: UK ($3.1T), France ($2.9T), Italy ($2.1T), Spain ($1.4T), Netherlands ($909B)");
        System.out.println("      Switzerland ($813B), Belgium ($530B), Austria ($480B), Ireland ($499B), Denmark ($395B)");
        System.out.println("   🌏 Asia-Pacific: South Korea ($1.8T), Australia ($1.6T), Taiwan ($791B), Singapore ($397B)");
        System.out.println("      Thailand ($544B), Malaysia ($433B), Indonesia ($1.3T), Philippines ($394B), Vietnam ($409B)");
        System.out.println("   🌎 Americas: Canada ($2.0T), Brazil ($1.6T), Mexico ($1.3T), Argentina ($487B), Chile ($317B)");
        System.out.println("      Colombia ($314B), Peru ($223B), Uruguay ($63B)");
        System.out.println("   🌍 Middle East & Africa: Saudi Arabia ($834B), UAE ($508B), Israel ($482B), Turkey ($819B)");
        System.out.println("      Iran ($231B), Egypt ($469B), South Africa ($419B), Nigeria ($441B), Kenya ($115B)");
        System.out.println("   🇷🇺 Eastern Europe: Russia ($2.2T), Poland ($679B), Czech Republic ($290B), Hungary ($181B)");
        System.out.println("   ❄️ Nordic Countries: Sweden ($635B), Norway ($482B), Finland ($297B), Iceland ($26B)");
        
        System.out.println("\n🔬 TOP 40 GLOBAL RESEARCH INSTITUTIONS:");
        System.out.println("   🇺🇸 US Elite (15): MIT, Stanford, Harvard, Caltech, Princeton, Yale, University of Chicago");
        System.out.println("      Columbia, UC Berkeley, UCLA, University of Pennsylvania, Johns Hopkins, Cornell, Duke, Northwestern");
        System.out.println("   🌍 International Elite (10): Oxford, Cambridge, Imperial College, UCL, King's College");
        System.out.println("      ETH Zurich, EPFL, University of Toronto, McGill, University of Melbourne");
        System.out.println("   🌏 Asian Powerhouses (10): Chinese Academy of Sciences, Tsinghua, Peking University");
        System.out.println("      University of Tokyo, RIKEN, Seoul National, NUS, NTU, Indian Institute of Science, IIT Delhi");
        System.out.println("   🇪🇺 European Excellence (5): Max Planck Society, CERN, CNRS, Sorbonne, TU Munich");
        
        System.out.println("\n🔮 20 ALTERNATIVE FUTURE SCENARIOS:");
        System.out.println("   🤖 Technology Futures (5): AI Supremacy, Quantum Revolution, Biotech Renaissance, Metaverse Dominance, Space Economy");
        System.out.println("   🌱 Environmental Futures (3): Green Transition Triumph, Climate Crisis Response, Circular Economy Revolution");
        System.out.println("   🌍 Geopolitical Futures (4): Multipolar World, Regional Bloc Dominance, Democratic Renaissance, Cyber Warfare Era");
        System.out.println("   💼 Economic Futures (3): Digital Economy Supremacy, Resource Scarcity Wars, Post-Capitalism Society");
        System.out.println("   👥 Social Futures (3): Aging Society Adaptation, Global Education Revolution, Post-Work Society");
        System.out.println("   🏥 Health Futures (2): Longevity Breakthrough, Pandemic Preparedness Era");
        System.out.println();
    }
    
    private static void runAIEnhancedSimulation() {
        System.out.println("🚀 STARTING AI-ENHANCED ULTRA-COMPREHENSIVE SIMULATION");
        System.out.println("Duration: 30 days (1 month strategic analysis)");
        System.out.println("Entities: 190 total (100 companies + 50 countries + 40 research centers)");
        System.out.println("AI Model: Qwen3-Next-80B-A3B-Thinking (Local)");
        System.out.println("Features: True AI decision making, cross-agent interactions, enhanced PESTEL");
        System.out.println();
        
        try {
            // Create AI-enhanced comprehensive simulation
            AIEnhancedPESTELEngine engine = new AIEnhancedPESTELEngine(30);
            engine.setSimulationTime(30.0);
            
            System.out.println("✅ AI-Enhanced simulation initialized");
            System.out.println("🤖 AI Integration: " + (engine.isAIEnabled() ? 
                "Local Qwen3-Next-80B-A3B-Thinking ACTIVE" : "Advanced Fallback Logic"));
            System.out.println("🔗 Agent Network: Comprehensive cross-agent influence mapping");
            System.out.println("📊 PESTEL Variables: Enhanced 66 variables across 6 categories");
            System.out.println();
            
            long startTime = System.currentTimeMillis();
            engine.run();
            long endTime = System.currentTimeMillis();
            
            System.out.println("\n🎉 AI-ENHANCED SIMULATION COMPLETED SUCCESSFULLY");
            System.out.println("Execution time: " + (endTime - startTime) + " ms");
            
            // Display comprehensive results
            displayAIEnhancedResults(engine);
            
        } catch (Exception e) {
            System.out.println("❌ Simulation error: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    private static void displayAIEnhancedResults(AIEnhancedPESTELEngine engine) {
        System.out.println("\n=== AI-ENHANCED COMPREHENSIVE SIMULATION RESULTS ===");
        
        // Get comprehensive scenario analysis
        EnhancedFutureScenarioManager.ScenarioAnalysis analysis = 
            engine.getEnhancedFutureManager().generateScenarioAnalysis();
        
        // Display top scenarios with detailed analysis
        System.out.println("\n🏆 FINAL ALTERNATIVE FUTURES RANKING:");
        java.util.List<EnhancedFutureScenarioManager.FutureScenario> topScenarios = 
            engine.getEnhancedFutureManager().getTopScenarios();
        
        for (int i = 0; i < topScenarios.size(); i++) {
            EnhancedFutureScenarioManager.FutureScenario scenario = topScenarios.get(i);
            String medal = i == 0 ? "🥇" : i == 1 ? "🥈" : "🥉";
            System.out.println(String.format("  %s %s: %.1f%% probability (%.2f momentum)", 
                medal, scenario.getName(), scenario.getProbability() * 100, scenario.getMomentum()));
            System.out.println(String.format("     Sector: %s", scenario.getDominantSector()));
            System.out.println(String.format("     Description: %s", scenario.getDescription()));
            
            if (!scenario.getSupportingActions().isEmpty()) {
                System.out.println("     Recent Supporting Actions:");
                scenario.getSupportingActions().stream().limit(3).forEach(action -> 
                    System.out.println("       - " + action));
            }
            System.out.println();
        }
        
        // Display sector analysis
        System.out.println("📊 SECTOR PROBABILITY ANALYSIS:");
        java.util.Map<String, Double> sectorProbs = analysis.getSectorProbabilities();
        sectorProbs.entrySet().stream()
            .sorted(java.util.Map.Entry.<String, Double>comparingByValue().reversed())
            .forEach(entry -> System.out.println(String.format("  %s: %.1f%% combined probability", 
                entry.getKey(), entry.getValue() * 100)));
        
        // Display cross-agent interactions
        System.out.println("\n🔗 CROSS-AGENT INTERACTION ANALYSIS:");
        java.util.List<AIEnhancedPESTELEngine.CrossAgentInteraction> interactions = 
            engine.getCrossAgentInteractions();
        System.out.println("  Total Interactions: " + interactions.size());
        
        // Most influential agents
        java.util.Map<String, Long> influenceCount = interactions.stream()
            .collect(java.util.stream.Collectors.groupingBy(
                AIEnhancedPESTELEngine.CrossAgentInteraction::getSourceAgentId, 
                java.util.stream.Collectors.counting()));
        
        System.out.println("\n🌟 MOST INFLUENTIAL AGENTS:");
        influenceCount.entrySet().stream()
            .sorted(java.util.Map.Entry.<String, Long>comparingByValue().reversed())
            .limit(5)
            .forEach(entry -> System.out.println(String.format("  %s: %d cross-agent influences", 
                entry.getKey(), entry.getValue())));
        
        // Display key trends
        System.out.println("\n📈 KEY STRATEGIC TRENDS:");
        for (String trend : analysis.getKeyTrends()) {
            System.out.println("  • " + trend);
        }
        
        // Display enhanced entity performance
        displayEnhancedEntityPerformance(engine);
        
        // Display AI vs Fallback statistics
        displayAIPerformanceStats(engine);
        
        // Display strategic recommendations
        System.out.println("\n🎯 STRATEGIC RECOMMENDATIONS FOR METROPOLIA UNIVERSITY:");
        for (String recommendation : analysis.getStrategicRecommendations()) {
            System.out.println("  • " + recommendation);
        }
        
        // Display simulation statistics
        displayEnhancedSimulationStatistics(engine);
    }
    
    private static void displayEnhancedEntityPerformance(AIEnhancedPESTELEngine engine) {
        System.out.println("\n📊 ENHANCED ENTITY PERFORMANCE ANALYSIS:");
        
        // Most active companies by sector
        java.util.Map<String, java.util.List<RealWorldCompany>> companiesBySector = 
            engine.getCompanies().stream()
                .collect(java.util.stream.Collectors.groupingBy(c -> extractMainSector(c.getCompanyData().industry)));
        
        System.out.println("\n🏢 MOST ACTIVE COMPANIES BY SECTOR:");
        companiesBySector.forEach((sector, companies) -> {
            RealWorldCompany mostActive = companies.stream()
                .max((c1, c2) -> Integer.compare(c1.getDecisionCount(), c2.getDecisionCount()))
                .orElse(null);
            if (mostActive != null && mostActive.getDecisionCount() > 0) {
                System.out.println(String.format("  %s: %s (%d AI decisions, $%.0fB revenue, %.2f influence)", 
                    sector, mostActive.getCompanyData().name, mostActive.getDecisionCount(), 
                    mostActive.getCompanyData().revenue / 1000, mostActive.getMarketInfluence()));
            }
        });
        
        // Most influential countries by region
        java.util.Map<String, java.util.List<RealWorldCountry>> countriesByRegion = 
            engine.getCountries().stream()
                .collect(java.util.stream.Collectors.groupingBy(c -> c.getCountryData().region));
        
        System.out.println("\n🏛️ MOST ACTIVE COUNTRIES BY REGION:");
        countriesByRegion.forEach((region, countries) -> {
            RealWorldCountry mostActive = countries.stream()
                .max((c1, c2) -> Integer.compare(c1.getDecisionCount(), c2.getDecisionCount()))
                .orElse(null);
            if (mostActive != null && mostActive.getDecisionCount() > 0) {
                System.out.println(String.format("  %s: %s (%d AI policies, $%.0fB GDP, %.2f influence)", 
                    region, mostActive.getCountryData().name, mostActive.getDecisionCount(), 
                    mostActive.getCountryData().gdp / 1000.0, mostActive.getGeopoliticalInfluence()));
            }
        });
        
        // Most productive research institutions by type
        java.util.Map<String, java.util.List<RealWorldResearcher>> researchersByType = 
            engine.getResearchers().stream()
                .collect(java.util.stream.Collectors.groupingBy(r -> r.getResearchData().type));
        
        System.out.println("\n🔬 MOST PRODUCTIVE RESEARCH INSTITUTIONS BY TYPE:");
        researchersByType.forEach((type, researchers) -> {
            RealWorldResearcher mostActive = researchers.stream()
                .max((r1, r2) -> Integer.compare(r1.getDecisionCount(), r2.getDecisionCount()))
                .orElse(null);
            if (mostActive != null && mostActive.getDecisionCount() > 0) {
                System.out.println(String.format("  %s: %s (%d AI initiatives, Impact: %.2f)", 
                    type, mostActive.getResearchData().name, mostActive.getDecisionCount(), 
                    mostActive.getResearchImpact()));
            }
        });
    }
    
    private static void displayAIPerformanceStats(AIEnhancedPESTELEngine engine) {
        System.out.println("\n🤖 AI PERFORMANCE STATISTICS:");
        System.out.println("  AI Integration Status: " + (engine.isAIEnabled() ? "✅ ACTIVE" : "❌ FALLBACK"));
        
        if (engine.isAIEnabled()) {
            System.out.println("  AI Model: Qwen3-Next-80B-A3B-Thinking (Local)");
            System.out.println("  AI Decision Quality: High-fidelity strategic analysis");
            System.out.println("  AI Response Time: Optimized for real-time simulation");
            System.out.println("  Privacy: Complete local processing, zero data transmission");
        } else {
            System.out.println("  Fallback Logic: Advanced rule-based decision making");
            System.out.println("  Decision Quality: Sophisticated pattern-based analysis");
        }
        
        // PESTEL change statistics
        int pestelChanges = engine.getRecentChanges().size();
        System.out.println("  PESTEL Analysis: " + pestelChanges + " comprehensive factor updates");
        System.out.println("  Cross-Agent Effects: " + engine.getCrossAgentInteractions().size() + " influence propagations");
    }
    
    private static void displayEnhancedSimulationStatistics(AIEnhancedPESTELEngine engine) {
        System.out.println("\n📈 ENHANCED SIMULATION STATISTICS:");
        
        int totalDecisions = engine.getCompanies().stream().mapToInt(PESTELAgent::getDecisionCount).sum() +
                           engine.getCountries().stream().mapToInt(PESTELAgent::getDecisionCount).sum() +
                           engine.getResearchers().stream().mapToInt(PESTELAgent::getDecisionCount).sum();
        
        int totalEntities = engine.getCompanies().size() + engine.getCountries().size() + engine.getResearchers().size();
        
        System.out.println("  Total Entities: " + totalEntities + " (100 companies + 50 countries + 40 research centers)");
        System.out.println("  Total AI/Strategic Decisions: " + totalDecisions);
        System.out.println("  Average Decisions per Entity: " + String.format("%.2f", (double) totalDecisions / totalEntities));
        System.out.println("  Enhanced PESTEL Changes: " + engine.getRecentChanges().size());
        System.out.println("  Cross-Agent Interactions: " + engine.getCrossAgentInteractions().size());
        System.out.println("  Alternative Futures Tracked: " + engine.getEnhancedFutureManager().getAllScenarios().size());
        
        // Decision distribution
        System.out.println("\n📊 AI DECISION DISTRIBUTION:");
        System.out.println("  Companies: " + engine.getCompanies().stream().mapToInt(PESTELAgent::getDecisionCount).sum() + " strategic decisions");
        System.out.println("  Countries: " + engine.getCountries().stream().mapToInt(PESTELAgent::getDecisionCount).sum() + " policy decisions");
        System.out.println("  Research: " + engine.getResearchers().stream().mapToInt(PESTELAgent::getDecisionCount).sum() + " research initiatives");
        
        // PESTEL category distribution
        java.util.Map<String, Long> pestelDistribution = engine.getRecentChanges().stream()
            .collect(java.util.stream.Collectors.groupingBy(PESTELChange::getCategory, 
                     java.util.stream.Collectors.counting()));
        
        System.out.println("\n🔄 PESTEL CHANGE DISTRIBUTION:");
        pestelDistribution.entrySet().stream()
            .sorted(java.util.Map.Entry.<String, Long>comparingByValue().reversed())
            .forEach(entry -> System.out.println(String.format("  %s: %d changes", 
                entry.getKey().toUpperCase(), entry.getValue())));
    }
    
    private static String extractMainSector(String industry) {
        String industryLower = industry.toLowerCase();
        if (industryLower.contains("technology") || industryLower.contains("software")) return "Technology";
        if (industryLower.contains("energy") || industryLower.contains("oil")) return "Energy";
        if (industryLower.contains("healthcare") || industryLower.contains("pharmaceutical")) return "Healthcare";
        if (industryLower.contains("financial") || industryLower.contains("bank")) return "Financial";
        if (industryLower.contains("automotive")) return "Automotive";
        if (industryLower.contains("retail") || industryLower.contains("e-commerce")) return "Retail";
        if (industryLower.contains("telecommunications")) return "Telecom";
        if (industryLower.contains("aerospace")) return "Aerospace";
        if (industryLower.contains("consumer")) return "Consumer Goods";
        return "Other";
    }
}
